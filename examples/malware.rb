#!/usr/bin/ruby -w
# Created by Luis Campo Giralte
# GPL License

require "../src/ruaiengine"

def callback_domain(flow)
    print "Malware domain on:%s" % flow
end

def loadBadDomains

    d = DomainNameManager.new
    file = File.new("zeus.dat","r")
    while (line = file.gets)
        dom = DomainName.new("Domain %s" % line.chomp,line.chomp)
        dom.setCallback(method(:callback_domain))
        d.addDomainName(dom)
    end
    file.close
    return d
end

d = loadBadDomains()

s = StackLan.new
pd = PacketDispatcher.new
pd.setStack(s)

s.setTotalTCPFlows(2000)
s.setTotalUDPFlows(2000)

s.setDomainNameManager(d,"HTTPProtocol")

pd.open("ens7")
begin
    pd.run()
rescue
    print "Stop capturing packets"
end

pd.close()

